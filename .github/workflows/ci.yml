name: Github Actions Demo
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:
    inputs:
      environment:
        description: Select the target environment
        default: dit1
        options:
          - dit1
          - sit1
          - uat1
        required: true
        type: choice
      tags:
        description: Provide commit tag
        default: ""
        required: true
        type: string

description: actions demo description
# permissions: write-all

jobs:
  Example-Action-job:
    name: first-job
    env:
      DB_PASS: "123"
      DB_USER: "db user"
    runs-on: [self-hosted, macOS, x64]
    steps:
      - name: Runner info
        env:
          FAIL_STEP: ${{ github.event.inputs.environment }}
        run: |
          echo  "The job was triggered by a ${{ github.event_name }} event and runner os is ${{ runner.os }}";
          echo " Runner os: ${{ runner.os}}"
          echo " Runner tools ${{ runner.tool_cache }}"
          echo " Runner object:- ${{ runner.arch }} ${{ runner.name}} ${{ runner.temp }}"
          echo " github run id: ${{ github.run_id }} ${{ github.ref_name}} ${{ github.run_number}}"
          # echo " github object: ${{ toJson(github) }}"
          echo " job status: ${{ job.status}}"
          echo " input variable environment value:- ${{ inputs.environment}}"
          echo " input variable environment value:- ${{ env.DB_PASS}} ${{ env.DB_USER}}"
          if [[ $FAIL_STEP == true]]
          then 
            exit 1
          fi

      - name: condition to check
        if: github.event_name == 'pull_request'
        run: echo " This is a pull request"
      - name: list files
        run: |
          ls ${{ github.workspace}}
      - name: checkout code
        uses: actions/checkout@v2
      - run: echo "The ${{ github.repository}} has been cloned to the runner"
      - name: setup dependencies
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 5.0.x
      - run: echo test
      - run: |
          echo " Action ref:- ${{ github.action_ref}}  ${{ env.APP_BRANCH_NAME}}" 
          cat ${{ env.APP_BRANCH_NAME}}
          if [[ ${{ env.APP_BRANCH_NAME == true}}]]
          then
            exit 1
          fi
        id: action-ref
        if: env.APP_BRANCH_NAME != null
        env:
          APP_BRANCH_NAME: ${{ github.ref}}
      - run: cat ${{ steps.action-ref.outputs}}
        if: steps.action-ref == success()

  Success-job:
    name: complete job
    runs-on: [self-hosted]
    needs: Example-Action-job
    steps:
      - name: Complete message
        run: echo "job completed"
